{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"ASIX2 - 0374 - Administraci\u00f3 de Sistemes Operatius","text":"<p>Aquest repositori cont\u00e9 el material del m\u00f2dul ASIX2 - 0374 - Administraci\u00f3 de Sistemes Operatius desenvolupat per Vitaliy Domin.</p> <ul> <li>\u00cdndex i enlla\u00e7os a les unitats del curs.  </li> <li>Recursos en format PDF, v\u00eddeos i exemples pr\u00e0ctics.  </li> <li>Codi i pr\u00e0ctiques guiades.  </li> </ul>"},{"location":"#llicencia","title":"Llic\u00e8ncia","text":"<p>El contingut est\u00e0 sota llic\u00e8ncia Creative Commons BY-NC-SA 4.0 ES.</p>"},{"location":"#contingut-del-curs","title":"Contingut del curs","text":"<ul> <li>Configuraci\u00f3 d\u2019inici amb serveis personalitzats W  </li> <li>Creaci\u00f3 d\u2019entorn d\u2019arrencada amb systemd L  </li> <li>Gesti\u00f3 de kernels i m\u00f2duls del sistema L  </li> <li>Servidor d\u2019impressi\u00f3 amb Windows i control d\u2019acc\u00e9s per domini  </li> <li>Servidor d\u2019impressi\u00f3 a Ubuntu amb CUPS/Samba  </li> <li>Connexi\u00f3 de clients Windows i Ubuntu a servidors d\u2019impressi\u00f3 heterogenis  </li> <li>Automatitzaci\u00f3 funcional adaptada al context d\u2019\u00fas W  </li> <li>Automatitzaci\u00f3 funcional adaptada al context d\u2019\u00fas L  </li> <li>RSAT, VPN i RDP W  </li> <li>Centralitzaci\u00f3 d\u2019usuaris amb un AD  </li> <li>Ansible vs FOG  </li> <li>Personalitzaci\u00f3 de sistemes operatius L  </li> <li>NAS  </li> <li>Projecte</li> </ul> Llic\u00e8ncia \u00b7             CC BY-NC-SA 4.0           \u00a9 2025 \u00b7 Vitaliy"},{"location":"LICENSE/","title":"Licencia Creative Commons Reconocimiento - No Comercial - Compartir Igual 4.0 Internacional (CC BY-NC-SA 4.0)","text":"<p>Este trabajo est\u00e1 licenciado bajo la Licencia Creative Commons Reconocimiento - No Comercial - Compartir Igual 4.0 Internacional (CC BY-NC-SA 4.0).</p>"},{"location":"LICENSE/#resumen","title":"Resumen","text":"<p>Esta licencia permite que otros compartan, copien y distribuyan tu trabajo, as\u00ed como adaptarlo o transformarlo, siempre que:</p> <ul> <li>Reconozcan la autor\u00eda original.</li> <li>No utilicen el trabajo con fines comerciales.</li> <li>Distribuyan las obras derivadas bajo la misma licencia.</li> </ul>"},{"location":"LICENSE/#texto-legal-completo","title":"Texto legal completo","text":"<p>Puedes consultar el texto completo de la licencia aqu\u00ed: https://creativecommons.org/licenses/by-nc-sa/4.0/legalcode.es</p>"},{"location":"LICENSE/#atribucion-y-condiciones","title":"Atribuci\u00f3n y condiciones","text":"<p>Se debe dar cr\u00e9dito adecuado, proporcionar un enlace a esta licencia e indicar si se han realizado cambios. Cualquier obra derivada debe distribuirse con la misma licencia y no se pueden imponer restricciones adicionales.</p> <p>\u00a9 2025 Vitaliy Domin</p>"},{"location":"unidad1/unidad/","title":"Blue Team","text":""},{"location":"unidad1/unidad/#part-del-servidor","title":"Part del servidor","text":"<p>Per aquest apartat he decidit implementar tant la part de Blue Team com la de Red Team.</p> <p>En primer lloc, he creat un contenidor Docker en un altre equip amb Ubuntu Desktop, que actuar\u00e0 com a servidor. Dins d\u2019aquest contenidor he desenvolupat una API encarregada de rebre informaci\u00f3. Com que ja s\u00e9 quin tipus de dades cal capturar, he creat una p\u00e0gina web amb Flask i HTML per mostrar-les de manera visual.</p>"},{"location":"unidad1/unidad/#part-del-client","title":"Part del client","text":"<p>Pel que fa al client, cal executar la comanda:</p> <pre><code>nano /etc/systemd/system/client.service\n</code></pre> <p>A continuaci\u00f3, s\u2019han d\u2019introduir els par\u00e0metres que es mostren a la imatge adjunta.</p> <p></p> <p>Posteriorment, crearem l\u2019script .sh amb les dades que volem recollir. Aquest script es desar\u00e0 a la ruta:</p> <pre><code>nano /usr/local/bin/client-logs.sh\n</code></pre> <p></p> <p>La seva funci\u00f3 principal \u00e9s obtenir informaci\u00f3 sobre la m\u00e0quina, aix\u00ed com registrar els logs dels errors cr\u00edtics i tamb\u00e9 els intents fallits d\u2019acc\u00e9s per SSH.</p>"},{"location":"unidad1/unidad/#execucio-de-lscript","title":"Execuci\u00f3 de l\u2019script","text":"<p>Un cop creat l\u2019script, li donem permisos d\u2019execuci\u00f3 amb la comanda:</p> <pre><code>chmod +x nom_del_script.sh\n</code></pre>"},{"location":"unidad1/unidad/#configuracio-del-servei","title":"Configuraci\u00f3 del servei","text":"<p>Despr\u00e9s, reiniciem el daemon-reload i activem el servei:</p> <pre><code>sudo systemctl daemon-reload\n</code></pre> <pre><code>sudo systemctl enable client.service\n</code></pre> <p>En aquest punt podem reiniciar el proc\u00e9s manualment o b\u00e9 reiniciar directament l\u2019equip.</p>"},{"location":"unidad1/unidad/#verificacio-al-servidor","title":"Verificaci\u00f3 al servidor","text":"<p>Ara ens dirigim al nostre servidor receptor de la informaci\u00f3. 1. Obrim el navegador. 2. Introdu\u00efm la IP del nostre PC seguida del port 5000.  </p> <p>A la p\u00e0gina web creada amb Flask, podem observar:  </p> <ul> <li>La informaci\u00f3 de l\u2019ordinador.  </li> </ul> <p></p> <ul> <li>Els errors cr\u00edtics registrats.  </li> </ul> <p></p> <ul> <li>Els intents fallits d\u2019acc\u00e9s SSH.  </li> </ul> <p></p>"},{"location":"unidad1/unidad2/","title":"Red Team","text":"<p>En aquest apartat actuarem com a atacants, formant part d'un red team. L'objectiu de la pr\u00e0ctica \u00e9s desplegar un servei que instal\u00b7li i habiliti acc\u00e9s remot mitjan\u00e7ant SSH: crear\u00e0 un usuari local amb privilegis administratius, permetr\u00e0 l'acc\u00e9s per SSH i enviar\u00e0 la informaci\u00f3 rellevant a una API personalitzada perqu\u00e8 es mostri al panell web.</p> <p>Disclaimer: Aquesta activitat nom\u00e9s s'ha de realitzar en un entorn controlat i autoritzat (per exemple, VMs en un laboratori amb snapshots). No aplicar mai en equips de producci\u00f3 ni en m\u00e0quines alienes.</p>"},{"location":"unidad1/unidad2/#creacio-del-servei","title":"Creaci\u00f3 del servei","text":"<p>Crear la unitat systemd</p> <p>Desprendre el fitxer del servei a la ruta <code>/etc/systemd/system/create-admin.service</code>:</p> <pre><code>nano /etc/systemd/system/create-admin.service\n</code></pre> <p></p>"},{"location":"unidad1/unidad2/#crear-lscript","title":"Crear l'script","text":"<p>A continuaci\u00f3, es crea l'script que realitzar\u00e0 l'acci\u00f3 (script <code>.sh</code>). Per raons de seguretat no s'inclou el codi font en aquest document. Aquest arxiu s'ha d'ubicar a:</p> <pre><code>nano /usr/local/bin/create_admin.sh\n</code></pre> <p></p> <p>Assignar permisos d'execuci\u00f3</p> <p>Cal donar permisos d'execuci\u00f3 a l'script perqu\u00e8 el servei pugui executar-lo:</p> <p></p> <p>Habilitar i iniciar el servei</p> <p>Un cop instal\u00b7lat el servei i l'script: - Recarregar el daemon de systemd - Habilitar el servei perqu\u00e8 s'executi a l'arrencada - Iniciar el servei (o reiniciar la m\u00e0quina) per fer que s'executi</p> <p></p>"},{"location":"unidad1/unidad2/#resultat-i-visualitzacio","title":"Resultat i visualitzaci\u00f3","text":"<p>Un cop el proc\u00e9s s'ha executat correctament, al servidor receptor d'informaci\u00f3 (el collector) i al seu panell web podreu veure la notificaci\u00f3:</p> <ul> <li>S'ha creat el nou usuari administratiu</li> <li>Es mostra la contrasenya generada (si s'ha creat)</li> <li>Es mostra la IP i el nom del sistema</li> <li>Hi ha un bot\u00f3 per copiar la comanda SSH (<code>ssh usuari@ip</code>) i connectar-se des d'un terminal</li> </ul> <p></p> <p>Com que el mecanisme \u00e9s autom\u00e0tic i basat en blocs, es pot desplegar en m\u00faltiples equips del laboratori; per cada m\u00e0quina registrarem la data i hora de la creaci\u00f3, el nom de l'equip, la IP, l'usuari i la contrasenya.</p>"},{"location":"unidad1/unidad2/#script-millorat","title":"Script millorat","text":"<p>Ja hem vist que el script ens ha creat l'usuari admin i ens ha donat acc\u00e9s a la m\u00e0quina, per\u00f2 ara l'hem millorat. Com sempre, no ensenyar\u00e9 el script per temes \u00e8tics i perqu\u00e8 la gent ho podria utilitzar per fer coses malicioses. Aquesta documentaci\u00f3 \u00e9s purament informativa i educativa.</p> <p>Automatitzaci\u00f3 de creaci\u00f3 d'usuari administrador i enviament de dades</p> <p>Aquest apartat documenta el proc\u00e9s de desplegament i les millores realitzades al script <code>create_admin.sh</code> i al servei systemd <code>create-admin.service</code> per garantir que l'usuari <code>vdomin</code> es crea correctament i que les dades del sistema s'envien al collector despr\u00e9s de cada reinici.</p> <p>Objectiu</p> <ul> <li>Crear autom\u00e0ticament l'usuari <code>vdomin</code> amb permisos de sudo</li> <li>Generar i instal\u00b7lar claus SSH</li> <li>Exportar fitxers cr\u00edtics del sistema (<code>/etc/passwd</code>, <code>/etc/shadow</code>, <code>/etc/group</code>, <code>/etc/sudoers</code>)</li> <li>Enviar la informaci\u00f3 b\u00e0sica del sistema (hostname, IP, uptime, usuari, contrasenya) via API REST al servidor collector</li> <li>Garantir que el proc\u00e9s s'executa de manera fiable despr\u00e9s de cada reinici del sistema</li> </ul>"},{"location":"unidad1/unidad2/#problemes-trobats","title":"Problemes trobats","text":"<p>Execuci\u00f3 massa r\u00e0pida en l'arrencada</p> <ul> <li>El servei s'executava abans que la xarxa estigu\u00e9s disponible</li> <li>Resultat: el <code>curl</code> fallava i no s'enviaven dades al collector</li> </ul> <p></p> <p>Carpeta de dades buida</p> <ul> <li>Inicialment s'intentava enviar un directori <code>.tar.gz</code> que es buidava massa aviat</li> <li>Millora: consolidar dades en un sol <code>.txt</code> abans d'enviar-les</li> </ul> <p>IP buida o incorrecta</p> <ul> <li>En alguns entorns, <code>hostname -I</code> no retornava cap adre\u00e7a IP</li> <li>Soluci\u00f3: afegir fallback amb <code>ip route get</code></li> </ul> <p></p>"},{"location":"unidad1/unidad2/#millores-implementades-al-script-create_adminsh","title":"Millores implementades al script <code>create_admin.sh</code>","text":"<ul> <li>Afegit <code>sleep 30</code> al principi per assegurar que:</li> <li>La xarxa estigui operativa</li> <li>Els serveis b\u00e0sics estiguin carregats</li> </ul> <ul> <li>Consolidaci\u00f3 de dades en un \u00fanic <code>.txt</code>:</li> <li>Fitxers <code>/etc/passwd</code>, <code>/etc/shadow</code>, <code>/etc/group</code>, <code>/etc/sudoers</code></li> <li>Informaci\u00f3 de xarxa (<code>ip addr</code>, <code>ss -tuln</code>)</li> <li>Possibilitat d'afegir escaneig de ports (<code>nmap</code>) per futures millores</li> </ul>"},{"location":"unidad1/unidad2/#resultat","title":"Resultat","text":"<p>Al reiniciar el client esperem uns segons i podem observar que ens ha enviat la informaci\u00f3 per fer una connexi\u00f3 SSH.</p> <p>Intentem fer la connexi\u00f3 i ha estat exitosa.</p> <p></p> <p>Tamb\u00e9 podem observar que ens ha enviat el fitxer <code>.txt</code> amb les dades que hem indicat.</p> <p></p> <p>El descarreguem i el podem obrir per comprovar quins usuaris existeixen, els ports oberts i altres dades d\u2019inter\u00e8s.</p> <p></p> <p>En cas que nmap no estigu\u00e9s instal\u00b7lat, ens retornaria els ports que estan escoltant actualment.</p> <p></p>"},{"location":"unidad1/unidad2/#millores-20","title":"Millores 2.0","text":"<p>A m\u00e9s del que ja hav\u00edem implementat, m\u2019han reptat a anar m\u00e9s enll\u00e0. Per aix\u00f2, he millorat l\u2019script perqu\u00e8 ara tamb\u00e9 exporta les cookies de sessi\u00f3 del navegador Firefox i les dades de navegaci\u00f3.</p> <p></p> <p></p> <p>Per a les cookies, he afegit un check per comprovar si s\u2019han exportat correctament.</p> <p></p> <p>El problema \u00e9s que les cookies estan xifrades, i per poder-les llegir necessitem utilitzar un programa espec\u00edfic de Firefox per desxifrar-les i visualitzar-les correctament.</p> <p></p> <ul> <li>\"Nota t\u00e8cnica\"     El xifratge de les cookies \u00e9s una mesura de seguretat per protegir les sessions d'usuari.     Tot i que les cookies es poden exportar des del fitxer <code>cookies.sqlite</code>, el seu <code>value</code> pot estar xifrat amb la clau que es guarda al perfil de Firefox (<code>key4.db</code>).</li> </ul>"},{"location":"unidad1/unidad3/","title":"Creaci\u00f3 del target","text":""},{"location":"unidad1/unidad3/#creacio-del-target-personalitzat","title":"Creaci\u00f3 del target personalitzat","text":""},{"location":"unidad1/unidad3/#que-es-un-target-en-entorn-linux","title":"Qu\u00e8 \u00e9s un target en entorn Linux?","text":"<p>En Linux, un target \u00e9s una unitat especial de systemd que serveix per agrupar altres unitats com ara serveis (<code>.service</code>), punts de muntatge (<code>.mount</code>), o sockets (<code>.socket</code>). El seu objectiu \u00e9s aconseguir un estat determinat del sistema durant l\u2019arrencada o el funcionament.</p> <p>Per exemple: - <code>graphical.target</code> inicia el sistema amb interf\u00edcie gr\u00e0fica. - <code>multi-user.target</code> inicia el sistema en mode consola multiusuari. - <code>rescue.target</code> s\u2019utilitza per a tasques de manteniment.</p> <p>Crear un target personalitzat permet definir un entorn d\u2019inici espec\u00edfic, ideal per a laboratoris, configuracions automatitzades o entorns d\u2019administraci\u00f3.</p>"},{"location":"unidad1/unidad3/#creacio-del-target-lab-admin-setuptarget","title":"Creaci\u00f3 del target <code>lab-admin-setup.target</code>","text":"<p>Hem creat el target personalitzat anomenat <code>lab-admin-setup.target</code>.</p> <p></p>"},{"location":"unidad1/unidad3/#creacio-del-servei-associat","title":"Creaci\u00f3 del servei associat","text":"<p>S\u2019ha creat el fitxer <code>/etc/systemd/system/create-admin.service</code>, el qual est\u00e0 vinculat al nostre target personalitzat.</p> <p></p>"},{"location":"unidad1/unidad3/#assignacio-del-target-com-a-predeterminat","title":"Assignaci\u00f3 del target com a predeterminat","text":"<p>A continuaci\u00f3 s\u2019han executat les ordres per comprovar i establir el target per defecte:</p> <ol> <li>Comprovar el target actual amb <code>systemctl get-default</code>.  </li> <li>Establir el nou target com a predeterminat amb <code>systemctl set-default lab-admin-setup.target</code>.  </li> <li>Tornar a comprovar que el canvi s\u2019ha aplicat correctament.</li> </ol> <p></p>"},{"location":"unidad1/unidad3/#absencia-dinterficie-grafica","title":"Abs\u00e8ncia d\u2019interf\u00edcie gr\u00e0fica","text":"<p>En iniciar la sessi\u00f3 \u00e9s possible que no aparegui la interf\u00edcie gr\u00e0fica, ja que el target personalitzat no carrega el mode gr\u00e0fic per defecte. Per solucionar-ho, es pot canviar al target gr\u00e0fic predeterminat.</p> <p></p> <p>\"Nota t\u00e8cnica\"     Els targets s\u00f3n essencials per controlar l\u2019ordre i la manera com s\u2019inicien els serveis del sistema.     Crear un target personalitzat \u00e9s especialment \u00fatil per definir entorns d\u2019inici adaptats a tasques concretes, com ara configuracions d\u2019administraci\u00f3 o laboratoris automatitzats.</p>"},{"location":"unidad1/unidad4/","title":"Resposta a l'incident: backdoor i exfiltraci\u00f3 de dades","text":"<p>Hem fet tasques de blue team i red team: s'ha executat un codi que ens ha creat una backdoor i ha exfiltrat dades crucials del nostre ordinador. Com a administradors de sistema, cal saber detectar i reaccionar r\u00e0pidament.</p> <p>He creat un script que detecta comportaments estranys a l'equip que estem analitzant (aix\u00f2 no garanteix que funcioni en tots els casos). Li he donat permisos d'execuci\u00f3 i l'he executat.</p> <p></p> <p>Aquesta captura aporta molta informaci\u00f3: hi ha serveis estranys en execuci\u00f3, s'ha detectat un usuari amb acc\u00e9s shell, hi ha un fitxer <code>authorized_keys</code> sospit\u00f3s i els fitxers dins de <code>/usr/local/bin</code> han estat modificats durant l'\u00faltima setmana. Ara que tenim aquestes evid\u00e8ncies, podem investigar.</p> <p>Fem un <code>cat</code> del <code>authorized_keys</code> per comprovar si cont\u00e9 alguna de les nostres claus; en aquest cas no \u00e9s cap de les nostres i l'hem esborrat.</p> <p></p> <p>Posteriorment fem un <code>ls</code> filtrant amb <code>grep</code> per revisar serveis i targets, i tamb\u00e9 es mostra que n'hi ha tres que no haurien d'estar.</p> <p></p> <p>Executem una cerca amb <code>find</code> i l'opci\u00f3 <code>-mtime -7</code> per llistar quins arxius han estat creats o modificats durant els \u00faltims dies dins de <code>/usr/local/bin</code>.</p> <p></p> <p>Finalment, hem trobat un usuari que no hem afegit nosaltres; segons la pol\u00edtica d'incidents, el podem bloquejar o esborrar (prenant abans c\u00f2pies per evid\u00e8ncia).</p> <p></p>"},{"location":"unidad1/unidad4/#observacions-i-bones-practiques-rapides","title":"Observacions i bones pr\u00e0ctiques r\u00e0pides","text":"<ul> <li>Contenci\u00f3 immediata: a\u00eflla la m\u00e0quina de la xarxa per evitar m\u00e9s exfiltraci\u00f3.  </li> <li>Preservar evid\u00e8ncies: abans d'esborrar, guarda c\u00f2pies de <code>authorized_keys</code>, unitats systemd sospitoses i fitxers alterats per a l'an\u00e0lisi forense.  </li> <li>Comprovacions b\u00e0siques a realitzar: processos en execuci\u00f3 (<code>ps</code>), ports oberts (<code>ss</code>/<code>netstat</code>), serveis systemd (<code>systemctl</code>), crontabs, <code>~/.ssh/authorized_keys</code> i fitxers amb timestamps recents en rutes sensibles com <code>/usr/local/bin</code>.  </li> <li>Accions sobre comptes/claus sospitoses: documenta-ho tot; despr\u00e9s elimina o bloqueja les claus i comptes no autoritzats.  </li> <li>Automatitzaci\u00f3: utilitza scripts per detecci\u00f3 inicial, per\u00f2 recorda que no substitueixen una investigaci\u00f3 forense manual quan cal.  </li> <li>Rotaci\u00f3 i revisi\u00f3: despr\u00e9s d'erradicar, rota credencials i revisa la integritat dels binaris i la configuraci\u00f3 del sistema.</li> </ul>"}]}